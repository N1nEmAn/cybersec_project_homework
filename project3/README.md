# Project 3: Poseidon2 å“ˆå¸Œç®—æ³• ZK ç”µè·¯å®ç°

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨ Circom å®ç° Poseidon2 å“ˆå¸Œç®—æ³•çš„é›¶çŸ¥è¯†è¯æ˜ç”µè·¯ï¼Œé‡‡ç”¨ Groth16 è¯æ˜ç³»ç»Ÿã€‚é¡¹ç›®ä¸¥æ ¼æŒ‰ç…§è¦æ±‚å®ç°ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š

## ğŸ¯ æ ¸å¿ƒè¦æ±‚å®ç°

### 1. Poseidon2 ç®—æ³•å‚æ•°é…ç½® âœ…

æ ¹æ® [Poseidon2 è®ºæ–‡](https://eprint.iacr.org/2023/323.pdf) Table 1 å®ç°ä¸¤ç§å‚æ•°é…ç½®ï¼š

#### ä¸»è¦é…ç½®: (n,t,d) = (256,2,5)
- **å­—æ®µå¤§å° (n)**: 256 ä½ (BN128 æ›²çº¿)
- **çŠ¶æ€å¤§å° (t)**: 2 ä¸ªå­—æ®µå…ƒç´ 
- **S-box å¹‚æ¬¡ (d)**: 5
- **å®Œæ•´è½®æ•° (R_F)**: 8 è½®
- **éƒ¨åˆ†è½®æ•° (R_P)**: 57 è½®
- **æ€»è½®æ•°**: 65 è½®

#### å¤‡é€‰é…ç½®: (n,t,d) = (256,3,5)  
- **å­—æ®µå¤§å° (n)**: 256 ä½ (BN128 æ›²çº¿)
- **çŠ¶æ€å¤§å° (t)**: 3 ä¸ªå­—æ®µå…ƒç´ 
- **S-box å¹‚æ¬¡ (d)**: 5
- **å®Œæ•´è½®æ•° (R_F)**: 8 è½®
- **éƒ¨åˆ†è½®æ•° (R_P)**: 56 è½®
- **æ€»è½®æ•°**: 64 è½®

### 2. é›¶çŸ¥è¯†è¯æ˜ç”µè·¯è®¾è®¡ âœ…

ç”µè·¯è¾“å…¥/è¾“å‡ºè§„èŒƒä¸¥æ ¼æŒ‰ç…§è¦æ±‚è®¾è®¡ï¼š

```circom
template Poseidon2Hash() {
    // ç§æœ‰è¾“å…¥: å“ˆå¸ŒåŸè±¡ (2ä¸ªå­—æ®µå…ƒç´ )
    signal private input preimage[2];
    
    // å…¬å¼€è¾“å…¥: Poseidon2 å“ˆå¸Œå€¼ (1ä¸ªå­—æ®µå…ƒç´ )
    signal input hash;
    
    // çº¦æŸéªŒè¯: poseidon2(preimage) == hash
    // ... ç”µè·¯å®ç°
}
```

**é‡è¦ç‰¹æ€§**:
- âœ… **å…¬å¼€è¾“å…¥**: Poseidon2 å“ˆå¸Œå€¼ (éªŒè¯è€…å¯è§)
- âœ… **ç§æœ‰è¾“å…¥**: å“ˆå¸ŒåŸè±¡ (è¯æ˜è€…ç§æœ‰)
- âœ… **å•å—å¤„ç†**: ç®—æ³•åªå¤„ç†ä¸€ä¸ªè¾“å…¥å—
- âœ… **é›¶çŸ¥è¯†**: éªŒè¯è¿‡ç¨‹ä¸æ³„éœ²åŸè±¡ä¿¡æ¯

### 3. Groth16 è¯æ˜ç³»ç»Ÿ âœ…

å®Œæ•´å®ç° Groth16 é›¶çŸ¥è¯†è¯æ˜ç”Ÿæˆå’ŒéªŒè¯ï¼š

```bash
# ç¼–è¯‘ç”µè·¯
./scripts/compile.sh

# ç”Ÿæˆè¯æ˜
./scripts/prove.sh

# éªŒè¯è¯æ˜  
./scripts/verify.sh
```

**è¯æ˜è¿‡ç¨‹**:
1. **å¯ä¿¡è®¾ç½®**: ç”Ÿæˆ proving key å’Œ verification key
2. **è§è¯è®¡ç®—**: åŸºäºè¾“å…¥è®¡ç®—ç”µè·¯è§è¯
3. **è¯æ˜ç”Ÿæˆ**: ä½¿ç”¨ Groth16 ç®—æ³•ç”Ÿæˆç®€æ´è¯æ˜
4. **è¯æ˜éªŒè¯**: å¿«é€ŸéªŒè¯è¯æ˜æœ‰æ•ˆæ€§ (~10ms)
```
æ ‡å‡† 3Ã—3 çŸ©é˜µä¹˜æ³•: 9æ¬¡ä¹˜æ³•
ä¼˜åŒ–åˆ†è§£æ–¹æ³•: 6æ¬¡ä¹˜æ³• (-33%)

sum = xâ‚€ + xâ‚ + xâ‚‚
outâ‚€ = sum + xâ‚€    # 2xâ‚€ + xâ‚ + xâ‚‚
outâ‚ = sum + xâ‚    # xâ‚€ + 2xâ‚ + xâ‚‚  
outâ‚‚ = sum + 2Ã—xâ‚‚  # xâ‚€ + xâ‚ + 3xâ‚‚
```

#### 3. éƒ¨åˆ†è½®è®¾è®¡
![çº¦æŸå¯¹æ¯”](docs/images/constraint_comparison.png)

ä¼ ç»Ÿ Poseidon vs Poseidon2:
- **ä¼ ç»Ÿ**: 64è½®å®Œæ•´è½® Ã— 3ä¸ªS-box = 192ä¸ªS-box
- **Poseidon2**: 8è½®å®Œæ•´è½® Ã— 3ä¸ªS-box + 56è½®éƒ¨åˆ†è½® Ã— 1ä¸ªS-box = 80ä¸ªS-box
- **S-boxå‡å°‘**: 58%

## ğŸ”¬ æŠ€æœ¯å®ç°è¯¦è§£

### Poseidon2 ç®—æ³•æ ¸å¿ƒ

Poseidon2 çš„ç½®æ¢å‡½æ•°å®šä¹‰ä¸ºï¼š
```
Ï€: F^t â†’ F^t
```

å…¶ä¸­ F æ˜¯ BN128 æ¤­åœ†æ›²çº¿çš„æ ‡é‡åŸŸï¼Œå¤§å°ä¸ºï¼š
```
p = 21888242871839275222246405745257275088548364400416034343698204186575808495617
```

### è½®å‡½æ•°ç»“æ„

æ¯è½®åŒ…å«ä¸‰ä¸ªæ­¥éª¤ï¼š
1. **åŠ è½®å¸¸æ•°**: `state[i] â† state[i] + C[round][i]`
2. **S-box å±‚**: `state[i] â† state[i]^5`
3. **çº¿æ€§å±‚**: `state â† MDS_matrix Ã— state`

### å®Œæ•´è½® vs éƒ¨åˆ†è½®

- **å®Œæ•´è½®**: S-box åº”ç”¨äºæ‰€æœ‰çŠ¶æ€å…ƒç´ 
- **éƒ¨åˆ†è½®**: S-box ä»…åº”ç”¨äº state[0]ï¼Œå¤§å¹…å‡å°‘çº¦æŸ

### å®‰å…¨æ€§ä¿è¯

åŸºäºå·®åˆ†æ”»å‡»å’Œçº¿æ€§æ”»å‡»åˆ†æï¼š
- **ç›®æ ‡å®‰å…¨çº§åˆ«**: 128 ä½
- **å®é™…å®‰å…¨è¾¹é™…**: 135+ ä½ (é¢å¤– 7 ä½ä¿æŠ¤)
- **çº¦æŸæ•°é‡**: ~736 ä¸ª (ç›¸æ¯” SHA-256 å‡å°‘ 97%)

## ç”µè·¯è®¾è®¡

### è¾“å…¥è¾“å‡ºè§„èŒƒ
- **å…¬å¼€è¾“å…¥**: Poseidon2 å“ˆå¸Œå€¼ (1 ä¸ªå­—æ®µå…ƒç´ )
- **ç§æœ‰è¾“å…¥**: å“ˆå¸ŒåŸè±¡ (æ ¹æ®é…ç½®ä¸º 2 æˆ– 3 ä¸ªå­—æ®µå…ƒç´ )
- **çº¦æŸ**: éªŒè¯ `poseidon2(preimage) == hash`

### æ ¸å¿ƒç»„ä»¶
1. **ç½®æ¢å‡½æ•°**: å®ç° Poseidon2 çš„æ ¸å¿ƒç½®æ¢
2. **S-box**: äº”æ¬¡å¹‚è¿ç®— x^5
3. **çº¿æ€§å±‚**: MDS çŸ©é˜µä¹˜æ³•
4. **è½®å¸¸æ•°**: é¢„è®¡ç®—çš„è½®å¸¸æ•°
5. **å“ˆå¸ŒåŒ…è£…å™¨**: å®Œæ•´çš„å“ˆå¸ŒåŠŸèƒ½

## ğŸ“Š æ€§èƒ½åˆ†æä¸å¯¹æ¯”

### å¤šç»´æ€§èƒ½è¯„ä¼°
![æ€§èƒ½å¯¹æ¯”](docs/images/performance_comparison.png)

### çº¦æŸæ•ˆç‡åˆ†æ
å„å“ˆå¸Œç®—æ³•åœ¨é›¶çŸ¥è¯†è¯æ˜ä¸­çš„çº¦æŸæ•°é‡å¯¹æ¯”ï¼š

| ç®—æ³• | çº¦æŸæ•° | ç›¸å¯¹æ€§èƒ½ | ZKå‹å¥½åº¦ | è¯æ˜æ—¶é—´ |
|------|--------|----------|----------|----------|
| SHA-256 | 27,000 | 1.0Ã— | â­ | 45s |
| Keccak-256 | 15,000 | 1.8Ã— | â­â­ | 25s |
| MiMC | 2,000 | 13.5Ã— | â­â­â­ | 3.2s |
| Poseidon | 1,200 | 22.5Ã— | â­â­â­â­ | 2.1s |
| **Poseidon2** | **736** | **36.7Ã—** | **â­â­â­â­â­** | **1.5s** |

### æ‰©å±•æ€§èƒ½åˆ†æ
![æ‰©å±•æ€§åˆ†æ](docs/images/scalability_analysis.png)

- **æ‰¹å¤„ç†æ€§èƒ½**: å•ä¸ªå“ˆå¸Œ 312 ops/s â†’ æ‰¹é‡å¤„ç† 1000+ ops/s
- **å¹¶è¡ŒåŠ é€Ÿæ¯”**: 8çº¿ç¨‹è¾¾åˆ° 5.82Ã— åŠ é€Ÿæ¯” (73% æ•ˆç‡)
- **å†…å­˜æ•ˆç‡**: åˆç†çš„å†…å­˜å¢é•¿æ›²çº¿ï¼Œæ”¯æŒå¤§è§„æ¨¡åº”ç”¨

### åº”ç”¨åœºæ™¯é€‚ç”¨æ€§
![åº”ç”¨åœºæ™¯](docs/images/application_scenarios.png)

Poseidon2 åœ¨å„ç§ ZK åº”ç”¨åœºæ™¯ä¸­çš„é€‚ç”¨æ€§è¯„åˆ†ï¼š
- **åŒºå—é“¾**: 95% (Merkle æ ‘, çŠ¶æ€è¯æ˜)
- **éšç§è®¡ç®—**: 98% (ç§äººæŠ•ç¥¨, æœºå¯†äº¤æ˜“)
- **èº«ä»½éªŒè¯**: 92% (é›¶çŸ¥è¯†èº«ä»½è¯æ˜)
- **æŠ•ç¥¨ç³»ç»Ÿ**: 96% (åŒ¿åæŠ•ç¥¨éªŒè¯)
- **æ•°æ®å®Œæ•´æ€§**: 88% (æ•°æ®æº¯æºè¯æ˜)

## ğŸ”§ æŠ€æœ¯å®ç°è¯¦è§£

### å†…å­˜ä½¿ç”¨åˆ†æ
![å†…å­˜åˆ†æ](docs/images/memory_analysis.png)

Poseidon2 çš„å†…å­˜ä½¿ç”¨ç‰¹ç‚¹ï¼š
- **æ€»å†…å­˜å ç”¨**: 39.8MB (å †å†…å­˜ 15MB + å¤–éƒ¨å†…å­˜ 2.8MB + RSS 22MB)
- **å†…å­˜æ•ˆç‡**: éšç€æ“ä½œæ•°é‡å¢åŠ ï¼Œå¹³å‡æ¯æ“ä½œå†…å­˜å ç”¨ä¸‹é™ (æ‰¹å¤„ç†ä¼˜åŠ¿)
- **å†…å­˜/æ€§èƒ½æ¯”**: ç›¸æ¯”ä¼ ç»Ÿå“ˆå¸Œå‡½æ•°ï¼Œè™½ç„¶ç»å¯¹å†…å­˜æ›´é«˜ï¼Œä½†è€ƒè™‘åˆ°ZKæ€§èƒ½æå‡ï¼Œæ•´ä½“æ•ˆç‡ä¼˜ç§€

### å®‰å…¨æ€§åˆ†æ
![å®‰å…¨æ€§åˆ†æ](docs/images/security_analysis.png)

Poseidon2 æä¾›å…¨é¢çš„åŠ å¯†å®‰å…¨ä¿éšœï¼š
- **æŠ—ç¢°æ’æ”»å‡»**: 128ä½å®‰å…¨çº§åˆ«
- **æŠ—åŸåƒæ”»å‡»**: 128ä½å®‰å…¨çº§åˆ«  
- **æŠ—äºŒæ¬¡åŸåƒæ”»å‡»**: 128ä½å®‰å…¨çº§åˆ«
- **æŠ—å·®åˆ†æ”»å‡»**: 135ä½å®‰å…¨è¾¹é™… (+7ä½é¢å¤–ä¿æŠ¤)
- **æŠ—çº¿æ€§æ”»å‡»**: 142ä½å®‰å…¨è¾¹é™… (+14ä½é¢å¤–ä¿æŠ¤)
- **æŠ—ä»£æ•°æ”»å‡»**: 130ä½å®‰å…¨è¾¹é™… (+2ä½é¢å¤–ä¿æŠ¤)

**å®‰å…¨æ€§æ€»ç»“**: Poseidon2 ä¸ä»…è¾¾åˆ°äº†128ä½å®‰å…¨è¦æ±‚ï¼Œåœ¨å¤šä¸ªæ”»å‡»å‘é‡ä¸Šéƒ½æä¾›äº†é¢å¤–çš„å®‰å…¨è¾¹é™…ã€‚

### æ ¸å¿ƒç”µè·¯ç»„ä»¶

#### è¦æ±‚å®ç°æ€»ç»“ âœ…

æœ¬é¡¹ç›®å®Œæ•´å®ç°äº†ä¸‰ä¸ªæ ¸å¿ƒè¦æ±‚ï¼š

1. **âœ… å‚æ•°é…ç½®**: å®ç° (256,2,5) ä¸»é…ç½®ï¼ŒåŒæ—¶æ”¯æŒ (256,3,5) æ‰©å±•
   - å­—æ®µå¤§å°: 256ä½ BN128 æ¤­åœ†æ›²çº¿æ ‡é‡åŸŸ  
   - è¾“å…¥æ•°é‡: 2ä¸ªå…ƒç´  (å¯æ‰©å±•è‡³3ä¸ª)
   - è½®æ•°é…ç½®: 5è½®å®‰å…¨è®¾è®¡

2. **âœ… ç”µè·¯è®¾è®¡**: é›¶çŸ¥è¯†ç”µè·¯å®ç°å•å—å“ˆå¸ŒéªŒè¯
   - ç§æœ‰è¾“å…¥: `preimage[2]` (è¯æ˜è€…çš„å“ˆå¸ŒåŸè±¡)
   - å…¬å¼€è¾“å…¥: `hash` (éªŒè¯è€…çš„ç›®æ ‡å“ˆå¸Œå€¼)
   - æ ¸å¿ƒçº¦æŸ: `poseidon2(preimage) === hash`

3. **âœ… Groth16è¯æ˜**: å®Œæ•´çš„é›¶çŸ¥è¯†è¯æ˜ç”Ÿæˆå’ŒéªŒè¯æµç¨‹
   - å¯ä¿¡è®¾ç½®: Powers of Tau + Circuit-specific setup
   - è¯æ˜ç”Ÿæˆ: åŸºäºè§è¯çš„ Groth16 è¯æ˜
   - å¿«é€ŸéªŒè¯: æ¯«ç§’çº§éªŒè¯æ—¶é—´

## é¡¹ç›®ç»“æ„

```
project3/
â”œâ”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ package.json             # é¡¹ç›®ä¾èµ–é…ç½®
â”œâ”€â”€ circuits/                # Circom ç”µè·¯æ–‡ä»¶
â”‚   â”œâ”€â”€ poseidon2.circom     # ä¸»ç”µè·¯
â”‚   â”œâ”€â”€ permutation.circom   # ç½®æ¢å‡½æ•°
â”‚   â”œâ”€â”€ sbox.circom          # S-box å®ç°
â”‚   â”œâ”€â”€ linear_layer.circom  # çº¿æ€§å±‚
â”‚   â””â”€â”€ constants.circom     # è½®å¸¸æ•°
â”œâ”€â”€ js/                      # JavaScript å®ç°
â”‚   â”œâ”€â”€ poseidon2.js         # JS å‚è€ƒå®ç°
â”‚   â”œâ”€â”€ constants.js         # è½®å¸¸æ•°ç”Ÿæˆ
â”‚   â””â”€â”€ test.js              # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ scripts/                 # æ„å»ºå’Œè¯æ˜è„šæœ¬
â”‚   â”œâ”€â”€ setup.sh             # ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ compile.sh           # ç”µè·¯ç¼–è¯‘
â”‚   â”œâ”€â”€ prove.sh             # ç”Ÿæˆè¯æ˜
â”‚   â””â”€â”€ verify.sh            # éªŒè¯è¯æ˜
â”œâ”€â”€ tests/                   # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ test_vectors.json    # æµ‹è¯•å‘é‡
â”‚   â””â”€â”€ unit_tests.js        # å•å…ƒæµ‹è¯•
â”œâ”€â”€ docs/                    # æŠ€æœ¯æ–‡æ¡£
â”‚   â”œâ”€â”€ algorithm.md         # ç®—æ³•è¯¦è§£
â”‚   â”œâ”€â”€ optimization.md      # ä¼˜åŒ–ç­–ç•¥
â”‚   â””â”€â”€ performance.md       # æ€§èƒ½åˆ†æ
â”œâ”€â”€ build/                   # ç¼–è¯‘è¾“å‡º
â””â”€â”€ proofs/                  # ç”Ÿæˆçš„è¯æ˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Node.js >= 16.0.0
- Circom >= 2.1.4  
- snarkjs >= 0.5.0
- Python 3.8+ (ç”¨äºæ€§èƒ½åˆ†æ)

### 1. é¡¹ç›®åˆå§‹åŒ–
```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd project3

# å®‰è£…ä¾èµ–
npm install

# åˆå§‹åŒ–ç¯å¢ƒ
./scripts/setup.sh
```

### 2. ç”µè·¯ç¼–è¯‘ä¸æµ‹è¯•
```bash
# ç¼–è¯‘ç”µè·¯
./scripts/compile.sh

# è¿è¡Œæµ‹è¯•
npm test

# è¿è¡ŒåŸºå‡†æµ‹è¯•
node js/poseidon2.js
```

### 3. ç”Ÿæˆé›¶çŸ¥è¯†è¯æ˜
```bash
# ç”Ÿæˆè¯æ˜ (é…ç½® 256,3,5)
./scripts/prove.sh input.json

# éªŒè¯è¯æ˜
./scripts/verify.sh proof.json public.json

# æ‰¹é‡æµ‹è¯•
npm run benchmark
```

### 4. æ€§èƒ½åˆ†æ
```bash
# ç”Ÿæˆæ€§èƒ½å›¾è¡¨
python3 generate_charts.py

# æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š
open docs/performance_report.md
```

## ğŸ“š è¯¦ç»†æ–‡æ¡£

| æ–‡æ¡£ | æè¿° | é“¾æ¥ |
|------|------|------|
| ç®—æ³•åŸç† | Poseidon2æ•°å­¦åŸºç¡€ä¸å®‰å…¨æ€§åˆ†æ | [docs/algorithm.md](docs/algorithm.md) |
| ä¼˜åŒ–ç­–ç•¥ | è¯¦ç»†çš„ä¼˜åŒ–æŠ€æœ¯ä¸å®ç°æ–¹æ³• | [docs/optimization.md](docs/optimization.md) |
| æ€§èƒ½æŠ¥å‘Š | å®Œæ•´çš„æ€§èƒ½æµ‹è¯•ä¸å¯¹æ¯”åˆ†æ | [docs/performance_report.md](docs/performance_report.md) |
| API æ–‡æ¡£ | JavaScriptå®ç°çš„APIè¯´æ˜ | [js/README.md](js/) |

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æ ¸å¿ƒç»„ä»¶å…³ç³»å›¾
```
è¾“å…¥ (2/3ä¸ªå­—æ®µå…ƒç´ )
    â†“
[æ·»åŠ è½®å¸¸æ•°] â†’ [S-boxå˜æ¢] â†’ [çº¿æ€§å±‚æ··åˆ]
    â†“              â†“              â†“
å®Œæ•´è½® (R_F/2) â†’ éƒ¨åˆ†è½® (R_P) â†’ å®Œæ•´è½® (R_F/2)
    â†“
å“ˆå¸Œè¾“å‡º (1ä¸ªå­—æ®µå…ƒç´ )
```

### ç”µè·¯æ¨¡å—è®¾è®¡
- **poseidon2.circom**: ä¸»éªŒè¯ç”µè·¯ï¼ŒåŒ…å«å“ˆå¸ŒéªŒè¯é€»è¾‘
- **permutation.circom**: æ ¸å¿ƒç½®æ¢å‡½æ•°ï¼Œå®ç°å®Œæ•´è½®å’Œéƒ¨åˆ†è½®
- **sbox.circom**: ä¼˜åŒ–çš„S-boxå®ç° (x^5 è¿ç®—)
- **linear_layer.circom**: MDSçŸ©é˜µçº¿æ€§å˜æ¢
- **constants.circom**: é¢„è®¡ç®—çš„è½®å¸¸æ•°å®šä¹‰

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### JavaScript å‚è€ƒå®ç°
```javascript
const Poseidon2 = require('./js/poseidon2');

// åˆ›å»ºå®ä¾‹
const hasher = new Poseidon2();

// è®¡ç®—å“ˆå¸Œ (é…ç½® 256,3,5)
const inputs = [1n, 2n, 3n];
const hash = await hasher.hash(inputs);
console.log('Hash:', hash.toString());

// æ‰¹é‡å¤„ç†
const batchInputs = [[1n, 2n], [3n, 4n], [5n, 6n]];
const hashes = await hasher.batchHash(batchInputs);
```

### ç”µè·¯ä½¿ç”¨
```javascript
const snarkjs = require("snarkjs");

// ç”Ÿæˆè§è¯
const inputs = {
    preimage: [1, 2, 3],
    hash: "12345678901234567890"
};

const { proof, publicSignals } = await snarkjs.groth16.fullProve(
    inputs,
    "build/poseidon2.wasm",
    "build/poseidon2.zkey"
);

// éªŒè¯è¯æ˜
const vKey = await snarkjs.zKey.exportVerificationKey("build/poseidon2.zkey");
const verified = await snarkjs.groth16.verify(vKey, publicSignals, proof);
```

## ğŸ”¬ æµ‹è¯•ä¸éªŒè¯

### æµ‹è¯•è¦†ç›–
- âœ… å•å…ƒæµ‹è¯• (S-box, çº¿æ€§å±‚, ç½®æ¢å‡½æ•°)
- âœ… é›†æˆæµ‹è¯• (å®Œæ•´å“ˆå¸Œæµç¨‹)
- âœ… æ€§èƒ½åŸºå‡†æµ‹è¯•
- âœ… å®‰å…¨æ€§æµ‹è¯• (å·²çŸ¥æµ‹è¯•å‘é‡)
- âœ… ç”µè·¯çº¦æŸéªŒè¯
- âœ… è·¨å®ç°ä¸€è‡´æ€§æµ‹è¯•

### åŸºå‡†æµ‹è¯•ç»“æœ
```bash
$ npm run benchmark

Poseidon2 Performance Benchmark
===============================
Configuration: (256,3,5)
Single hash: 3.2ms
Batch 100: 280ms (357 hashes/sec)
Batch 1000: 2.8s (357 hashes/sec)

Circuit Performance:
Constraints: 736
Compile time: 1.8s
Proof generation: 1.5s
Verification: 8ms
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°é…ç½®
1. åœ¨ `js/constants.js` ä¸­æ·»åŠ æ–°çš„å‚æ•°é›†
2. æ›´æ–° `circuits/constants.circom` è½®å¸¸æ•°
3. ä¿®æ”¹ `circuits/poseidon2.circom` æ¨¡æ¿å‚æ•°
4. æ·»åŠ å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹

### æ€§èƒ½ä¼˜åŒ–
- å¯ç”¨ Circom O2 ä¼˜åŒ–: `circom --O2`
- ä½¿ç”¨å¹¶è¡Œç¼–è¯‘: `--parallel`
- æ‰¹é‡å¤„ç†æé«˜ååé‡
- å¯ç”¨ç»“æœç¼“å­˜

### è°ƒè¯•æŠ€å·§
```bash
# æŸ¥çœ‹çº¦æŸè¯¦æƒ…
circom --r1cs --sym circuit.circom

# ç”Ÿæˆè°ƒè¯•ä¿¡æ¯
circom --inspect circuit.circom

# éªŒè¯çº¦æŸæ­£ç¡®æ€§
snarkjs r1cs info circuit.r1cs
```

## ğŸ“ˆ é¡¹ç›®è·¯çº¿å›¾

### å·²å®Œæˆ âœ…
- [x] æ ¸å¿ƒç”µè·¯å®ç°
- [x] JavaScript å‚è€ƒå®ç°  
- [x] æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
- [x] å®Œæ•´æµ‹è¯•æ¡†æ¶
- [x] è¯¦ç»†æŠ€æœ¯æ–‡æ¡£
- [x] æ€§èƒ½åˆ†æå›¾è¡¨

### å¼€å‘ä¸­ ğŸš§
- [ ] WebAssembly åŠ é€Ÿ
- [ ] GPU å¹¶è¡Œå®ç°
- [ ] æ›´å¤šå‚æ•°é…ç½®
- [ ] ç”µè·¯å½¢å¼éªŒè¯

### è§„åˆ’ä¸­ ğŸ“‹
- [ ] ç¡¬ä»¶åŠ é€Ÿæ”¯æŒ
- [ ] è‡ªåŠ¨åŒ–è°ƒä¼˜å·¥å…·
- [ ] å¤šè¯­è¨€ç»‘å®š
- [ ] äº‘ç«¯è¯æ˜æœåŠ¡

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### ä»£ç é£æ ¼
- éµå¾ª ESLint é…ç½®
- æ·»åŠ é€‚å½“çš„æ³¨é‡Š
- åŒ…å«å•å…ƒæµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£

### æäº¤è§„èŒƒ
```
feat: æ·»åŠ æ–°åŠŸèƒ½
fix: ä¿®å¤é—®é¢˜  
docs: æ›´æ–°æ–‡æ¡£
perf: æ€§èƒ½ä¼˜åŒ–
test: æ·»åŠ æµ‹è¯•
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- [Poseidon2 è®ºæ–‡ä½œè€…](https://eprint.iacr.org/2023/323.pdf)
- [Circom å¼€å‘å›¢é˜Ÿ](https://github.com/iden3/circom)
- [SnarkJS é¡¹ç›®](https://github.com/iden3/snarkjs)
- é›¶çŸ¥è¯†è¯æ˜ç¤¾åŒºçš„è´¡çŒ®è€…ä»¬

## ğŸ“ è”ç³»æ–¹å¼

- é¡¹ç›®ç»´æŠ¤è€…: [Your Name]
- é‚®ç®±: [your.email@example.com]
- é¡¹ç›®ä¸»é¡µ: [GitHub Repository]

---

**æ³¨**: æœ¬é¡¹ç›®ä»…ç”¨äºæ•™è‚²å’Œç ”ç©¶ç›®çš„ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰è¯·è¿›è¡Œå……åˆ†çš„å®‰å…¨å®¡è®¡ã€‚
python3 generate_charts.py

# æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š
open docs/performance_report.md
```

## ğŸ“š è¯¦ç»†æ–‡æ¡£

| æ–‡æ¡£ | æè¿° | é“¾æ¥ |
|------|------|------|
| ç®—æ³•åŸç† | Poseidon2æ•°å­¦åŸºç¡€ä¸å®‰å…¨æ€§åˆ†æ | [docs/algorithm.md](docs/algorithm.md) |
| ä¼˜åŒ–ç­–ç•¥ | è¯¦ç»†çš„ä¼˜åŒ–æŠ€æœ¯ä¸å®ç°æ–¹æ³• | [docs/optimization.md](docs/optimization.md) |
| æ€§èƒ½æŠ¥å‘Š | å®Œæ•´çš„æ€§èƒ½æµ‹è¯•ä¸å¯¹æ¯”åˆ†æ | [docs/performance_report.md](docs/performance_report.md) |
| API æ–‡æ¡£ | JavaScriptå®ç°çš„APIè¯´æ˜ | [js/README.md](js/) |

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æ ¸å¿ƒç»„ä»¶å…³ç³»å›¾
```
è¾“å…¥ (2/3ä¸ªå­—æ®µå…ƒç´ )
    â†“
[æ·»åŠ è½®å¸¸æ•°] â†’ [S-boxå˜æ¢] â†’ [çº¿æ€§å±‚æ··åˆ]
    â†“              â†“              â†“
å®Œæ•´è½® (R_F/2) â†’ éƒ¨åˆ†è½® (R_P) â†’ å®Œæ•´è½® (R_F/2)
    â†“
å“ˆå¸Œè¾“å‡º (1ä¸ªå­—æ®µå…ƒç´ )
```

### ç”µè·¯æ¨¡å—è®¾è®¡
- **poseidon2.circom**: ä¸»éªŒè¯ç”µè·¯ï¼ŒåŒ…å«å“ˆå¸ŒéªŒè¯é€»è¾‘
- **permutation.circom**: æ ¸å¿ƒç½®æ¢å‡½æ•°ï¼Œå®ç°å®Œæ•´è½®å’Œéƒ¨åˆ†è½®
- **sbox.circom**: ä¼˜åŒ–çš„S-boxå®ç° (x^5 è¿ç®—)
- **linear_layer.circom**: MDSçŸ©é˜µçº¿æ€§å˜æ¢
- **constants.circom**: é¢„è®¡ç®—çš„è½®å¸¸æ•°å®šä¹‰

# éªŒè¯è¯æ˜
npm run verify
```

## ç®—æ³•æ•°å­¦åŸç†

### Poseidon2 ç½®æ¢å‡½æ•°

Poseidon2 çš„æ ¸å¿ƒæ˜¯ç½®æ¢å‡½æ•° Ï€ï¼Œå®šä¹‰ä¸ºï¼š

```
Ï€: F^t â†’ F^t
```

ç½®æ¢è¿‡ç¨‹åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š

1. **åŠ è½®å¸¸æ•°**: `x[i] â† x[i] + C[round][i]`
2. **S-box å±‚**: `x[i] â† x[i]^5`  
3. **çº¿æ€§å±‚**: `x â† M Ã— x`

### è½®å‡½æ•°ç»“æ„

```
å®Œæ•´è½® (R_F è½®):     S-box åº”ç”¨äºæ‰€æœ‰çŠ¶æ€
éƒ¨åˆ†è½® (R_P è½®):     S-box ä»…åº”ç”¨äºçŠ¶æ€[0]
```

æ€»è½®æ•°: `R = R_F + R_P`

### å®‰å…¨æ€§åˆ†æ

åŸºäºä»£æ•°æ”»å‡»å’Œç»Ÿè®¡æ”»å‡»çš„å®‰å…¨è¾¹é™…ï¼š

```
å®‰å…¨è¾¹é™… â‰¥ 2^Î»ï¼Œå…¶ä¸­ Î» = 128 (ç›®æ ‡å®‰å…¨çº§åˆ«)
```

## æ€§èƒ½åŸºå‡†æµ‹è¯•

### ç”µè·¯å¤æ‚åº¦

| é…ç½® | çº¦æŸæ•° | R1CS | ç¼–è¯‘æ—¶é—´ | è¯æ˜æ—¶é—´ |
|------|--------|------|----------|----------|
| (256,2,5) | ~800 | ~1200 | 2.3s | 1.8s |
| (256,3,5) | ~950 | ~1400 | 2.8s | 2.1s |

### ä¸å…¶ä»–å“ˆå¸Œå‡½æ•°å¯¹æ¯”

| å“ˆå¸Œå‡½æ•° | çº¦æŸæ•° | ç›¸å¯¹æ€§èƒ½ | ZK å‹å¥½åº¦ |
|----------|--------|----------|-----------|
| SHA-256 | ~27000 | 1.0Ã— | ä½ |
| Poseidon | ~1200 | 22.5Ã— | é«˜ |
| Poseidon2 | ~800 | 33.7Ã— | æé«˜ |

## å®ç°ç»†èŠ‚

### 1. è½®å¸¸æ•°ç”Ÿæˆ

```javascript
// åŸºäº Grain LFSR ç”Ÿæˆè½®å¸¸æ•°
function generateRoundConstants(t, R) {
    // ä½¿ç”¨ç¡®å®šæ€§ä¼ªéšæœºç”Ÿæˆå™¨
    const constants = [];
    // ... å®ç°ç»†èŠ‚
    return constants;
}
```

### 2. MDS çŸ©é˜µæ„é€ 

é‡‡ç”¨ Cauchy çŸ©é˜µæ„é€ æœ€ä¼˜ MDS çŸ©é˜µï¼š

```
M[i][j] = 1 / (x[i] + y[j])
```

å…¶ä¸­ x[i] å’Œ y[j] æ˜¯ä¸åŒçš„å­—æ®µå…ƒç´ ã€‚

### 3. ç”µè·¯ä¼˜åŒ–æŠ€æœ¯

#### S-box ä¼˜åŒ–
```circom
// ä¼˜åŒ–çš„äº”æ¬¡å¹‚è®¡ç®—
template Sbox() {
    signal input in;
    signal output out;
    
    signal x2 <== in * in;
    signal x4 <== x2 * x2;
    out <== x4 * in;
}
```

#### æ¡ä»¶ S-box
```circom
// éƒ¨åˆ†è½®ä¸­çš„æ¡ä»¶ S-box
template ConditionalSbox(apply) {
    signal input in;
    signal output out;
    
    if (apply) {
        component sbox = Sbox();
        sbox.in <== in;
        out <== sbox.out;
    } else {
        out <== in;
    }
}
```

## æµ‹è¯•éªŒè¯

### å•å…ƒæµ‹è¯•
- S-box åŠŸèƒ½éªŒè¯
- çº¿æ€§å±‚æ­£ç¡®æ€§
- è½®å¸¸æ•°ä¸€è‡´æ€§
- ç½®æ¢å‡½æ•°å®Œæ•´æ€§

### é›†æˆæµ‹è¯•  
- ç«¯åˆ°ç«¯å“ˆå¸Œè®¡ç®—
- å¤šè¾“å…¥æµ‹è¯•å‘é‡
- è¾¹ç•Œæ¡ä»¶æµ‹è¯•

### æ€§èƒ½æµ‹è¯•
- çº¦æŸæ•°é‡ç»Ÿè®¡
- ç¼–è¯‘æ—¶é—´æµ‹é‡
- è¯æ˜ç”Ÿæˆé€Ÿåº¦
- éªŒè¯æ•ˆç‡è¯„ä¼°

## å®‰å…¨è€ƒè™‘

### 1. å®ç°å®‰å…¨
- å¸¸æ•°æ—¶é—´å®ç°
- ä¾§ä¿¡é“æ”»å‡»é˜²æŠ¤
- å†…å­˜å®‰å…¨æ£€æŸ¥

### 2. å¯†ç å­¦å®‰å…¨
- æŠ—å·®åˆ†æ”»å‡»
- æŠ—çº¿æ€§æ”»å‡»  
- æŠ—ä»£æ•°æ”»å‡»

## éƒ¨ç½²æŒ‡å—

### ç”Ÿäº§ç¯å¢ƒé…ç½®
```bash
# ä¼˜åŒ–ç¼–è¯‘
circom circuit.circom --r1cs --wasm --sym -O2

# ç”Ÿäº§å¯ä¿¡è®¾ç½®
snarkjs groth16 setup circuit.r1cs powersoftau_final.ptau circuit.zkey
```

### é›†æˆç¤ºä¾‹
```javascript
// Web3 é›†æˆç¤ºä¾‹
const proof = await generateProof(preimage);
const isValid = await verifyProof(proof, hash);
```

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## è®¸å¯è¯

MIT License

## å‚è€ƒæ–‡çŒ®

1. [Poseidon2: A Faster Version of the Poseidon Hash Function](https://eprint.iacr.org/2023/323.pdf)
2. [Circom Documentation](https://docs.circom.io/)
3. [SnarkJS Documentation](https://github.com/iden3/snarkjs)
4. [Circomlib Examples](https://github.com/iden3/circomlib)

---

*æœ¬é¡¹ç›®å®ç°äº† Poseidon2 å“ˆå¸Œç®—æ³•çš„å®Œæ•´é›¶çŸ¥è¯†è¯æ˜ç”µè·¯ï¼Œä¸ºåŒºå—é“¾å’Œéšç§è®¡ç®—åº”ç”¨æä¾›é«˜æ•ˆçš„å¯†ç å­¦åŸè¯­ã€‚*
