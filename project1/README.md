# SM4 åŠ å¯†ç®—æ³• - é«˜æ€§èƒ½ C è¯­è¨€å®ç°

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Language: C](https://img.shields.io/badge/Language-C-blue.svg)](https://en.wikipedia.org/wiki/C_(programming_language))
[![Architecture: Multi](https://img.shields.io/badge/Architecture-Multi-green.svg)](https://github.com)

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ SM4 åˆ†ç»„å¯†ç ç®—æ³• C è¯­è¨€å®ç°ï¼Œæ”¯æŒå¤šç§æ¶æ„ä¼˜åŒ–å’Œé«˜æ€§èƒ½è®¡ç®—ã€‚æœ¬é¡¹ç›®å®ç°äº†ä¸­å›½å›½å®¶æ ‡å‡† GB/T 32907-2016 ä¸­è§„å®šçš„ SM4 åˆ†ç»„å¯†ç ç®—æ³•ã€‚

## ğŸ“– é¡¹ç›®æ¦‚è¿°

SM4 æ˜¯ä¸­åäººæ°‘å…±å’Œå›½å›½å®¶å¯†ç ç®¡ç†å±€å‘å¸ƒçš„åˆ†ç»„å¯†ç æ ‡å‡†ï¼Œç”¨äºæ— çº¿å±€åŸŸç½‘äº§å“ã€‚æœ¬é¡¹ç›®æä¾›äº†é«˜åº¦ä¼˜åŒ–çš„ C è¯­è¨€å®ç°ï¼ŒåŒ…å«å¤šç§æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ã€‚

### ğŸš€ ä¸»è¦ç‰¹æ€§

- **å®Œæ•´çš„ SM4 ç®—æ³•å®ç°**ï¼šæ”¯æŒåŠ å¯†å’Œè§£å¯†æ“ä½œ
- **å¤šæ¶æ„ä¼˜åŒ–**ï¼š
  - åŸºç¡€ C å®ç°ï¼ˆå¯ç§»æ¤æ€§æœ€é«˜ï¼‰
  - æŸ¥æ‰¾è¡¨ä¼˜åŒ–ç‰ˆæœ¬ï¼ˆå‡å°‘è®¡ç®—å¼€é”€ï¼‰
  - x86-64 AVX2 SIMD ä¼˜åŒ–ï¼ˆå¤§å¹…æå‡æ€§èƒ½ï¼‰
  - ARM64 NEON ä¼˜åŒ–ï¼ˆARM å¤„ç†å™¨ä¸“ç”¨ï¼‰
- **å¤šç§å·¥ä½œæ¨¡å¼**ï¼šECBã€CBC æ¨¡å¼æ”¯æŒ
- **PKCS#7 å¡«å……**ï¼šè‡ªåŠ¨å¤„ç†éå¯¹é½æ•°æ®
- **å…¨é¢æµ‹è¯•**ï¼šåŒ…å«æ ‡å‡†æµ‹è¯•å‘é‡éªŒè¯
- **æ€§èƒ½åŸºå‡†æµ‹è¯•**ï¼šè¯¦ç»†çš„æ€§èƒ½åˆ†æå·¥å…·
- **æ™ºèƒ½æ„å»ºç³»ç»Ÿ**ï¼šè‡ªåŠ¨æ£€æµ‹æ¶æ„å¹¶é€‰æ‹©æœ€ä¼˜å®ç°

## ğŸ”¬ SM4 ç®—æ³•æ•°å­¦åŸç†

### ç®—æ³•ç»“æ„

SM4 é‡‡ç”¨ 32 è½®çš„ Feistel ç»“æ„ï¼Œæ¯è½®ä½¿ç”¨è½®å‡½æ•° Fï¼š

```
F(Xâ‚€, Xâ‚, Xâ‚‚, Xâ‚ƒ, RK) = Xâ‚€ âŠ• T(Xâ‚ âŠ• Xâ‚‚ âŠ• Xâ‚ƒ âŠ• RK)
```

å…¶ä¸­ T æ˜¯åˆæˆç½®æ¢ï¼ŒT = L âˆ˜ Ï„ï¼ŒåŒ…å«ï¼š

### éçº¿æ€§å˜æ¢ Ï„ (Sç›’)

Ï„ å‡½æ•°å¯¹ 32 ä½è¾“å…¥çš„æ¯ä¸ªå­—èŠ‚å¹¶è¡Œåº”ç”¨ S ç›’ï¼š

```
Ï„(A) = (Sbox(aâ‚€), Sbox(aâ‚), Sbox(aâ‚‚), Sbox(aâ‚ƒ))
```

å…¶ä¸­ A = (aâ‚€, aâ‚, aâ‚‚, aâ‚ƒ)ï¼Œæ¯ä¸ª aáµ¢ ä¸º 8 ä½ã€‚

### çº¿æ€§å˜æ¢ L

å¯¹äºåŠ å¯†è½®å‡½æ•°ï¼Œçº¿æ€§å˜æ¢ L å®šä¹‰ä¸ºï¼š

```
L(B) = B âŠ• (B â‰ª 2) âŠ• (B â‰ª 10) âŠ• (B â‰ª 18) âŠ• (B â‰ª 24)
```

å¯¹äºå¯†é’¥æ‰©å±•ï¼Œä½¿ç”¨ L' å˜æ¢ï¼š

```
L'(B) = B âŠ• (B â‰ª 13) âŠ• (B â‰ª 23)
```

### å¯†é’¥æ‰©å±•ç®—æ³•

1. **åˆå§‹åŒ–**ï¼šå°† 128 ä½å¯†é’¥ MK åˆ†ä¸º 4 ä¸ª 32 ä½å­— MKâ‚€, MKâ‚, MKâ‚‚, MKâ‚ƒ
2. **ä¸ç³»ç»Ÿå‚æ•°å¼‚æˆ–**ï¼š
   ```
   Kâ‚€ = MKâ‚€ âŠ• FKâ‚€, Kâ‚ = MKâ‚ âŠ• FKâ‚, Kâ‚‚ = MKâ‚‚ âŠ• FKâ‚‚, Kâ‚ƒ = MKâ‚ƒ âŠ• FKâ‚ƒ
   ```
3. **è½®å¯†é’¥ç”Ÿæˆ**ï¼šå¯¹äº i = 0, 1, ..., 31
   ```
   rk_i = K_i âŠ• T'(K_{i+1} âŠ• K_{i+2} âŠ• K_{i+3} âŠ• CK_i)
   K_{i+4} = rk_i
   ```

å…¶ä¸­ T' = L' âˆ˜ Ï„

### åŠ å¯†è¿‡ç¨‹

è¾“å…¥æ˜æ–‡ X = (Xâ‚€, Xâ‚, Xâ‚‚, Xâ‚ƒ)ï¼Œ32 è½®è¿­ä»£ï¼š

```
X_{i+4} = X_i âŠ• T(X_{i+1} âŠ• X_{i+2} âŠ• X_{i+3} âŠ• rk_i)
```

æœ€ç»ˆååºå˜æ¢ï¼š
```
Y = (Xâ‚ƒâ‚…, Xâ‚ƒâ‚„, Xâ‚ƒâ‚ƒ, Xâ‚ƒâ‚‚)
```

## ğŸ“Š æ€§èƒ½æµ‹è¯•ç»“æœ

### åŸºå‡†æµ‹è¯•ç»“æœ

![æ€§èƒ½å¯¹æ¯”å›¾è¡¨](performance_comparison.png)

åŸºäºæœ€æ–°æµ‹è¯•çš„æ€§èƒ½ç»“æœï¼š

| å®ç°ç‰ˆæœ¬ | æ‰§è¡Œæ—¶é—´ (ms) | ååé‡ (MB/s) | ç›¸å¯¹åŠ é€Ÿæ¯” | æ•ˆç‡å¾—åˆ† |
|----------|---------------|---------------|------------|----------|
| åŸºç¡€å®ç° | 22.45 | 67.98 | 1.00x | 1.000 |
| æŸ¥æ‰¾è¡¨ä¼˜åŒ– | 21.73 | 70.22 | 1.03x | 1.033 |
| AVX2 SIMD | 17.52 | 87.07 | 1.28x | 1.281 |

### å¤šæ¶æ„æ€§èƒ½å¯¹æ¯”

![æ¶æ„å¯¹æ¯”å›¾è¡¨](architecture_comparison.png)

ä¸åŒæ¶æ„ä¸‹çš„æ€§èƒ½è¡¨ç°ï¼š

- **x86-64 å¹³å°**ï¼šAVX2 SIMD ä¼˜åŒ–æä¾›æœ€ä½³æ€§èƒ½
- **ARM64 å¹³å°**ï¼šNEON æŒ‡ä»¤é›†ä¼˜åŒ–
- **é€šç”¨å¹³å°**ï¼šçº¯ C å®ç°ä¿è¯å…¼å®¹æ€§

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
project1/
â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ Makefile                     # æ™ºèƒ½æ„å»ºç³»ç»Ÿ
â”œâ”€â”€ generate_charts.py           # æ€§èƒ½å›¾è¡¨ç”Ÿæˆå™¨
â”œâ”€â”€ performance_comparison.png   # æ€§èƒ½å¯¹æ¯”å›¾è¡¨
â”œâ”€â”€ architecture_comparison.png  # æ¶æ„å¯¹æ¯”å›¾è¡¨
â”œâ”€â”€ src/                         # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ sm4.h                   # SM4 ç®—æ³•å¤´æ–‡ä»¶å’Œå¸¸æ•°å®šä¹‰
â”‚   â”œâ”€â”€ sm4_basic.c             # åŸºç¡€å®ç°
â”‚   â”œâ”€â”€ sm4_optimized.c         # æŸ¥æ‰¾è¡¨ä¼˜åŒ–å®ç°
â”‚   â”œâ”€â”€ sm4_simd.c              # x86-64 AVX2 SIMD å®ç°
â”‚   â””â”€â”€ sm4_neon.c              # ARM64 NEON å®ç°
â”œâ”€â”€ tests/                       # æµ‹è¯•ç›®å½•
â”‚   â””â”€â”€ test_sm4.c              # ç»¼åˆæµ‹è¯•å¥—ä»¶
â”œâ”€â”€ benchmarks/                  # æ€§èƒ½æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ benchmark.c             # å…¨é¢æ€§èƒ½åŸºå‡†æµ‹è¯•
â”‚   â””â”€â”€ quick_benchmark.c       # å¿«é€Ÿæ€§èƒ½æµ‹è¯•
â”œâ”€â”€ demo/                        # æ¼”ç¤ºç¨‹åºç›®å½•
â”‚   â””â”€â”€ sm4_demo.c              # åŠŸèƒ½æ¼”ç¤ºç¨‹åº
â”œâ”€â”€ bin/                         # ç¼–è¯‘è¾“å‡ºç›®å½•
â”œâ”€â”€ obj/                         # å¯¹è±¡æ–‡ä»¶ç›®å½•
â””â”€â”€ docs/                        # æ–‡æ¡£ç›®å½•
```

## ğŸ”§ å¿«é€Ÿå¼€å§‹

### ç³»ç»Ÿè¦æ±‚

- **ç¼–è¯‘å™¨**ï¼šGCC 7.0+ æˆ– Clang 10.0+
- **ç³»ç»Ÿ**ï¼šLinux/macOS/Windowsï¼ˆWSLï¼‰
- **æ¶æ„**ï¼šx86-64ã€ARM64 æˆ–å…¶ä»–ï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼‰

### ç¼–è¯‘æ„å»º

```bash
# æ„å»ºæ‰€æœ‰ç»„ä»¶
make all

# è¿è¡Œæµ‹è¯•
make test

# å¿«é€Ÿæ€§èƒ½æµ‹è¯•
make quick-test

# è¿è¡Œæ¼”ç¤º
./bin/sm4_demo
```

### æµ‹è¯•éªŒè¯

é¡¹ç›®åŒ…å«æ ‡å‡†æµ‹è¯•å‘é‡éªŒè¯ï¼š

```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
./bin/test_sm4

# æµ‹è¯•è¾“å‡ºç¤ºä¾‹
SM4 Algorithm Test Suite
========================
Testing Basic SM4 Encryption/Decryption
Test 1: Standard Test Vector 1
Key       : 0123456789ABCDEFFEDCBA9876543210
Plaintext : 0123456789ABCDEFFEDCBA9876543210
Expected  : 681EDF34D206965E86B3E94F536E4246
Computed  : [å®é™…è®¡ç®—ç»“æœ]
```

## ğŸ§ª è¯¦ç»† API ä½¿ç”¨

### åŸºæœ¬åŠ å¯†/è§£å¯†

```c
#include "sm4.h"

int main() {
    sm4_ctx_t ctx;
    uint8_t key[SM4_KEY_SIZE] = {
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF,
        0xFE, 0xDC, 0xBA, 0x98, 0x76, 0x54, 0x32, 0x10
    };
    uint8_t plaintext[SM4_BLOCK_SIZE] = {
        0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF,
        0xFE, 0xDC, 0xBA, 0x98, 0x76, 0x54, 0x32, 0x10
    };
    uint8_t ciphertext[SM4_BLOCK_SIZE];
    uint8_t decrypted[SM4_BLOCK_SIZE];

    // è®¾ç½®åŠ å¯†å¯†é’¥
    sm4_setkey_enc(&ctx, key);

    // æ‰§è¡ŒåŠ å¯†ï¼ˆå¯é€‰æ‹©ä¸åŒå®ç°ï¼‰
    sm4_encrypt_basic(&ctx, plaintext, ciphertext);      // åŸºç¡€å®ç°
    sm4_encrypt_optimized(&ctx, plaintext, ciphertext);  // ä¼˜åŒ–å®ç°
    sm4_encrypt_simd(&ctx, plaintext, ciphertext);       // SIMD å®ç°

    // è®¾ç½®è§£å¯†å¯†é’¥
    sm4_setkey_dec(&ctx, key);

    // æ‰§è¡Œè§£å¯†
    sm4_decrypt_basic(&ctx, ciphertext, decrypted);

    return 0;
}
```

### ECB æ¨¡å¼åŠ å¯†

```c
// ECB æ¨¡å¼å¤§æ•°æ®åŠ å¯†
size_t data_size = 1024;  // æ•°æ®å¤§å°ï¼ˆå¿…é¡»æ˜¯16å­—èŠ‚çš„å€æ•°ï¼‰
uint8_t *input_data = malloc(data_size);
uint8_t *output_data = malloc(data_size);

sm4_ctx_t ctx;
sm4_setkey_enc(&ctx, key);

// ECB åŠ å¯†
int result = sm4_ecb_encrypt(&ctx, input_data, data_size, output_data);
if (result == 0) {
    printf("ECB åŠ å¯†æˆåŠŸ\n");
}

// ECB è§£å¯†
sm4_setkey_dec(&ctx, key);
result = sm4_ecb_decrypt(&ctx, output_data, data_size, input_data);
```

### CBC æ¨¡å¼åŠ å¯†

```c
// CBC æ¨¡å¼åŠ å¯†
uint8_t iv[SM4_BLOCK_SIZE] = {0};  // åˆå§‹åŒ–å‘é‡
uint8_t input_data[32] = {...};    // è¾“å…¥æ•°æ®
uint8_t output_data[32];

sm4_ctx_t ctx;
sm4_setkey_enc(&ctx, key);

// CBC åŠ å¯†
int result = sm4_cbc_encrypt(&ctx, iv, input_data, 32, output_data);

// CBC è§£å¯†ï¼ˆæ³¨æ„ï¼šéœ€è¦é‡æ–°è®¾ç½® IVï¼‰
uint8_t iv_copy[SM4_BLOCK_SIZE];
memcpy(iv_copy, original_iv, SM4_BLOCK_SIZE);
sm4_setkey_dec(&ctx, key);
result = sm4_cbc_decrypt(&ctx, iv_copy, output_data, 32, input_data);
```

### PKCS#7 å¡«å……å¤„ç†

```c
// è‡ªåŠ¨å¡«å……ç¤ºä¾‹
size_t original_len = 10;  // åŸå§‹æ•°æ®é•¿åº¦
size_t padded_len = sm4_get_padded_length(original_len);  // è®¡ç®—å¡«å……åé•¿åº¦

uint8_t *padded_data = malloc(padded_len);
memcpy(padded_data, original_data, original_len);

// åº”ç”¨ PKCS#7 å¡«å……
sm4_apply_pkcs7_padding(padded_data, original_len, padded_len);

// åŠ å¯†å¡«å……åçš„æ•°æ®
sm4_ecb_encrypt(&ctx, padded_data, padded_len, encrypted_data);

// è§£å¯†å¹¶ç§»é™¤å¡«å……
sm4_ecb_decrypt(&ctx, encrypted_data, padded_len, decrypted_data);
size_t unpadded_len = sm4_remove_pkcs7_padding(decrypted_data, padded_len);
```

## ğŸ” ä¼˜åŒ–æŠ€æœ¯è¯¦è§£

### 1. æŸ¥æ‰¾è¡¨ä¼˜åŒ– (T-table)

é¢„è®¡ç®— S ç›’å˜æ¢å’Œçº¿æ€§å˜æ¢çš„ç»„åˆï¼š

```c
// T-table é¢„è®¡ç®—
uint32_t sm4_t0[256], sm4_t1[256], sm4_t2[256], sm4_t3[256];

// åˆå§‹åŒ– T-table
for (int i = 0; i < 256; i++) {
    uint32_t s = sm4_sbox[i];
    uint32_t t = s | (s << 8) | (s << 16) | (s << 24);
    sm4_t0[i] = sm4_linear_transform(t);
    sm4_t1[i] = rotl(sm4_t0[i], 8);
    sm4_t2[i] = rotl(sm4_t0[i], 16);
    sm4_t3[i] = rotl(sm4_t0[i], 24);
}
```

### 2. SIMD ä¼˜åŒ– (AVX2)

ä½¿ç”¨ 256 ä½å‘é‡å¹¶è¡Œå¤„ç†ï¼š

```c
#include <immintrin.h>

// å¹¶è¡Œ S ç›’æŸ¥æ‰¾
__m256i sm4_sbox_parallel(__m256i input) {
    // ä½¿ç”¨ gather æŒ‡ä»¤å¹¶è¡ŒæŸ¥æ‰¾ S ç›’
    __m256i result = _mm256_i32gather_epi32((int*)sm4_sbox_table, input, 4);
    return result;
}
```

### 3. å†…å­˜è®¿é—®ä¼˜åŒ–

- **ç¼“å­˜å‹å¥½**ï¼šæ•°æ®ç»“æ„å¯¹é½åˆ°ç¼“å­˜è¡Œ
- **å‡å°‘å†…å­˜åˆ†é…**ï¼šé¢„åˆ†é…ç¼“å†²åŒº
- **å±€éƒ¨æ€§ä¼˜åŒ–**ï¼šç›¸å…³æ•°æ®æ”¾åœ¨ä¸€èµ·

### 4. ç¼–è¯‘å™¨ä¼˜åŒ–

```bash
# å¯ç”¨çš„ç¼–è¯‘å™¨ä¼˜åŒ–
-O3                  # æœ€é«˜çº§åˆ«ä¼˜åŒ–
-march=native        # é’ˆå¯¹å½“å‰ CPU ä¼˜åŒ–
-mtune=native        # è°ƒä¼˜æŒ‡ä»¤è°ƒåº¦
-mavx2               # å¯ç”¨ AVX2 æŒ‡ä»¤é›†
```

## ğŸ“ˆ æ€§èƒ½åˆ†æ

### ç”Ÿæˆå®Œæ•´çš„æ€§èƒ½åˆ†æå›¾è¡¨

```bash
# å®‰è£…ä¾èµ–
pip install matplotlib numpy

# ç”Ÿæˆå®Œæ•´æ€§èƒ½åˆ†æ
python generate_charts.py

# è¿è¡Œè¯¦ç»†åŸºå‡†æµ‹è¯•
make benchmark
```

å›¾è¡¨å°†å±•ç¤ºï¼š
- ä¸åŒå®ç°ç‰ˆæœ¬çš„æ‰§è¡Œæ—¶é—´å¯¹æ¯”
- ååé‡åˆ†æ
- ç›¸å¯¹åŠ é€Ÿæ¯”
- æ•ˆç‡è¯„åˆ†
- å¤šæ¶æ„æ€§èƒ½å¯¹æ¯”

### æ€§èƒ½è°ƒä¼˜å»ºè®®

1. **CPU å¯†é›†å‹åœºæ™¯**ï¼šä½¿ç”¨ SIMD ä¼˜åŒ–ç‰ˆæœ¬
2. **å†…å­˜å—é™åœºæ™¯**ï¼šä½¿ç”¨åŸºç¡€å®ç°å‡å°‘å†…å­˜å ç”¨
3. **æ‰¹é‡å¤„ç†**ï¼šé€‰æ‹© ECB æ¨¡å¼è·å¾—æ›´å¥½çš„å¹¶è¡Œæ€§
4. **å®‰å…¨æ€§è¦æ±‚é«˜**ï¼šä½¿ç”¨ CBC æ¨¡å¼å¢å¼ºå®‰å…¨æ€§

## ğŸ› ï¸ æ„å»ºç³»ç»Ÿ

### å¯ç”¨çš„ Make ç›®æ ‡

```bash
make help           # æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨ç›®æ ‡
make all            # æ„å»ºæ‰€æœ‰ç»„ä»¶
make test           # è¿è¡Œæµ‹è¯•å¥—ä»¶
make quick-test     # è¿è¡Œå¿«é€Ÿæ€§èƒ½æµ‹è¯•
make benchmark      # è¿è¡Œè¯¦ç»†åŸºå‡†æµ‹è¯•
make clean          # æ¸…ç†æ„å»ºæ–‡ä»¶

# æ¶æ„ç‰¹å®šæ„å»º
make x86_64         # x86-64 ä¼˜åŒ–ç‰ˆæœ¬
make aarch64        # ARM64 ä¼˜åŒ–ç‰ˆæœ¬
make generic        # é€šç”¨ç‰ˆæœ¬

# è°ƒè¯•å’Œåˆ†æ
make debug          # è°ƒè¯•ç‰ˆæœ¬
make coverage       # ä»£ç è¦†ç›–ç‡åˆ†æ
make memcheck       # å†…å­˜æ£€æŸ¥
```

### äº¤å‰ç¼–è¯‘æ”¯æŒ

```bash
# ARM64 äº¤å‰ç¼–è¯‘
CC=aarch64-linux-gnu-gcc make aarch64

# RISC-V äº¤å‰ç¼–è¯‘
CC=riscv64-linux-gnu-gcc make generic
```

## ğŸ”’ å®‰å…¨æ€§è€ƒè™‘

### å¸¸é‡æ—¶é—´å®ç°

æ‰€æœ‰å…³é”®è¿ç®—éƒ½å®ç°ä¸ºå¸¸é‡æ—¶é—´ï¼Œé˜²æ­¢æ—¶åºæ”»å‡»ï¼š

```c
// å¸¸é‡æ—¶é—´ S ç›’æŸ¥æ‰¾
uint8_t constant_time_sbox(uint8_t input) {
    uint8_t result = 0;
    for (int i = 0; i < 256; i++) {
        uint8_t mask = (i == input) ? 0xFF : 0x00;
        result |= sm4_sbox[i] & mask;
    }
    return result;
}
```

### å†…å­˜å®‰å…¨

- è‡ªåŠ¨æ¸…é›¶æ•æ„Ÿæ•°æ®
- è¾¹ç•Œæ£€æŸ¥
- é˜²æ­¢ç¼“å†²åŒºæº¢å‡º

## ğŸ“š æ ‡å‡†æµ‹è¯•å‘é‡

é¡¹ç›®åŒ…å« GB/T 32907-2016 æ ‡å‡†ä¸­çš„æµ‹è¯•å‘é‡ï¼š

```
æµ‹è¯•å‘é‡ 1:
å¯†é’¥:     0123456789ABCDEFFEDCBA9876543210
æ˜æ–‡:     0123456789ABCDEFFEDCBA9876543210
æœŸæœ›å¯†æ–‡: 681EDF34D206965E86B3E94F536E4246

æµ‹è¯•å‘é‡ 2:  
å¯†é’¥:     FEDCBA98765432100123456789ABCDEF
æ˜æ–‡:     FEDCBA98765432100123456789ABCDEF
æœŸæœ›å¯†æ–‡: F766678F13834AA0408A2A2984408526
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

---

**æ³¨æ„**ï¼šæœ¬å®ç°ä»…ç”¨äºå­¦ä¹ ç ”ç©¶ç›®çš„ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å¯†ç ç®—æ³•æ—¶ï¼Œè¯·ç¡®ä¿éµå¾ªç›¸å…³å®‰å…¨æ ‡å‡†å’Œæœ€ä½³å®è·µã€‚

## ğŸ”§ å¿«é€Ÿå¼€å§‹

### ç³»ç»Ÿè¦æ±‚

- **ç¼–è¯‘å™¨**ï¼šGCC 7.0+ æˆ– Clang 10.0+
- **ç³»ç»Ÿ**ï¼šLinux/macOS/Windowsï¼ˆWSLï¼‰
- **æ¶æ„**ï¼šx86-64ã€ARM64 æˆ–å…¶ä»–ï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼‰

### ç¼–è¯‘æ„å»º

```bash
# æ„å»ºæ‰€æœ‰ç»„ä»¶
make all

# è¿è¡Œæµ‹è¯•
make test

# å¿«é€Ÿæ€§èƒ½æµ‹è¯•
make quick-test

# è¿è¡Œæ¼”ç¤º
./bin/sm4_demo
```

## ğŸ“Š æ€§èƒ½è¡¨ç°

### åŸºå‡†æµ‹è¯•ç»“æœ

åŸºäº x86-64 æ¶æ„çš„æ€§èƒ½æµ‹è¯•ç»“æœï¼š

| å®ç°ç‰ˆæœ¬ | ååé‡ (MB/s) | ç›¸å¯¹åŠ é€Ÿæ¯” |
|----------|---------------|------------|
| åŸºç¡€å®ç° | 67.0 | 1.00x |
| æŸ¥æ‰¾è¡¨ä¼˜åŒ– | 97.1 | 1.45x |
| AVX2 SIMD | 95.2 | 1.40x |

### æ¶æ„æ”¯æŒ

- âœ… **x86-64**ï¼šæ”¯æŒ SSE4.1ã€AVX2 æŒ‡ä»¤é›†ä¼˜åŒ–
- âœ… **ARM64**ï¼šæ”¯æŒ NEON SIMD æŒ‡ä»¤ä¼˜åŒ–
- âœ… **é€šç”¨æ¶æ„**ï¼šçº¯ C å®ç°ï¼Œå¯ç§»æ¤æ€§æœ€é«˜

## ğŸ§ª API ä½¿ç”¨ç¤ºä¾‹

```c
#include "sm4.h"

// åŸºæœ¬åŠ å¯†ç¤ºä¾‹
sm4_ctx_t ctx;
uint8_t key[16] = {...};
uint8_t plaintext[16] = {...};
uint8_t ciphertext[16];

// è®¾ç½®åŠ å¯†å¯†é’¥
sm4_setkey_enc(&ctx, key);

// æ‰§è¡ŒåŠ å¯†
sm4_encrypt_basic(&ctx, plaintext, ciphertext);

// ECB æ¨¡å¼åŠ å¯†å¤§é‡æ•°æ®
sm4_ecb_encrypt(&ctx, large_data, data_size, encrypted_data);
```

## ğŸ“ˆ æ€§èƒ½åˆ†æ

ç”Ÿæˆæ€§èƒ½å›¾è¡¨ï¼š

```bash
pip install matplotlib numpy
python generate_charts.py
```

## ğŸ› ï¸ å¯ç”¨å‘½ä»¤

```bash
make help           # æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨ç›®æ ‡
make all            # æ„å»ºæ‰€æœ‰ç»„ä»¶
make test           # è¿è¡Œæµ‹è¯•å¥—ä»¶
make benchmark      # è¿è¡Œæ€§èƒ½æµ‹è¯•
make clean          # æ¸…ç†æ„å»ºæ–‡ä»¶
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

---

**æ³¨æ„**ï¼šæœ¬å®ç°ä»…ç”¨äºå­¦ä¹ ç ”ç©¶ç›®çš„ã€‚
